---
title: "ffmpeg avformat"
excerpt: "ffmpeg提取文件格式"
date: 2025-01-29T17:40:00+08:00
categories:
  - blog
tags:
  - ffmpeg
---

```cpp
auto url = "D:/music/四季ノ唄.mp3";

AVFormatContext* fmt;
auto ret = avformat_open_input(&fmt, url, nullptr, nullptr);
if (ret < 0)
{
    av_log(nullptr, AV_LOG_ERROR, "Cannot open %s format : %s", url, av_err2str(ret));
    exit(EXIT_FAILURE);
}

av_dump_format(fmt, 0, url, 0);

avformat_close_input(&fmt);
```

`AVFormatContext`用于保存文件的格式信息。

`avformat_open_input`用于读取文件头信息，第一个参数就是存储返回信息的地方，第二个是要打开的url，第三个和第四个默认nullptr就好。

`av_dump_format`用于直接输出格式信息。

`avformat_close_input`则是释放fmt资源防止资源泄露。